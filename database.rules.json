{
  "rules": {
    
    "users": {
      ".read": true,

      "$user_id": {
        // grants write access to the owner of this user account
        // whose uid must exactly match the key ($user_id)
        ".write": "$user_id === auth.uid",
        ".indexOn": ["displayName", "numFollowers"],

        // Set the Allowed Fields to be written
        "displayName": {
          ".validate": true
        },
        "lastOnline": {
          ".validate": true
        },
        "profilePhoto": {
          ".validate": true
        },

        // Any other fields not allowed
        "$any": {
          ".validate": false
        }
      }
    },

    // The people a specific user is following
    "user-following": {
      "$user_id": {
        ".read": true,
        ".write": "$user_id === auth.uid",

        "$following_user_id": {
          ".validate": 
            "root.child('users').hasChild($following_user_id) && (newData.val() === true) && ($following_user_id != $user_id)"
        }
      }
    },

    // The people that are following a specific user.
    "user-followers": {
      "$user_id": {
        ".read": true,
        ".write": "$user_id === auth.uid",

        "$follower_user_id": {
          ".validate": 
            "root.child('users').hasChild($follower_user_id) && (newData.val() === true) && ($follower_user_id != $user_id)"
        }
      }
    },
      
    // Storage of country selection
    "user-country-selection": {
      "$user_id": {
        // grants read/write access to the owner of this user account
        // whose uid must exactly match the key ($user_id)
        ".read": "$user_id === auth.uid",
        ".write": "$user_id === auth.uid",
          
        "$region": {
          "name": {
            ".validate": true
          },
          "numCountriesSelected": {
            ".validate": "newData.isNumber()"
          },
          "totalCountriesInRegion": {
            ".validate": "newData.isNumber()"
          }
        }
      }
    },

    "regions": {
      ".read": true,
      ".write": false
    }
    
  }
}